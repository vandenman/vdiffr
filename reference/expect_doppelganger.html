<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Does a figure look like its expected output? — expect_doppelganger • vdiffr</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Does a figure look like its expected output? — expect_doppelganger" />

<meta property="og:description" content="expect_doppelganger() takes a figure to check visually.
If the figure has yet to be validated, the test is skipped. Call
manage_cases() to validate the new figure, so vdiffr knows what
to compare against.
If the test has been validated, fig is compared to the
validated figure. If the plot differs, a failure is issued
(except on CRAN, see section on regression testing below).
Either fix the problem, or call manage_cases() to validate the
new figure appearance.
" />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">vdiffr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Release notes</li>
    <li>
      <a href="https://www.tidyverse.org/articles/2019/01/vdiffr-0-3-0/">Version 0.3.0</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="../news/index.html">Change log</a>
    </li>
  </ul>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/r-lib/vdiffr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Does a figure look like its expected output?</h1>
    <small class="dont-index">Source: <a href='https://github.com/r-lib/vdiffr/blob/master/R/testthat-ui.R'><code>R/testthat-ui.R</code></a></small>
    <div class="hidden name"><code>expect_doppelganger.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p><code>expect_doppelganger()</code> takes a figure to check visually.</p><ul>
<li><p>If the figure has yet to be validated, the test is skipped. Call
<code><a href='manage_cases.html'>manage_cases()</a></code> to validate the new figure, so vdiffr knows what
to compare against.</p></li>
<li><p>If the test has been validated, <code>fig</code> is compared to the
validated figure. If the plot differs, a failure is issued
(except on CRAN, see section on regression testing below).</p>
<p>Either fix the problem, or call <code><a href='manage_cases.html'>manage_cases()</a></code> to validate the
new figure appearance.</p></li>
</ul>
    
    </div>

    <pre class="usage"><span class='fu'>expect_doppelganger</span>(<span class='no'>title</span>, <span class='no'>fig</span>, <span class='kw'>path</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>...</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>writer</span> <span class='kw'>=</span> <span class='no'>write_svg</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>title</th>
      <td><p>A brief description of what is being tested in the
figure. For instance: "Points and lines overlap".</p>
<p>If a ggplot2 figure doesn't have a title already, <code>title</code> is
applied to the figure with <code>ggtitle()</code>.</p>
<p>The title is also used as file name for storing SVG (in a
sanitzed form, with special characters converted to <code>"-"</code>).</p></td>
    </tr>
    <tr>
      <th>fig</th>
      <td><p>A figure to test. This can be a ggplot object, a
recordedplot, or more generally any object with a <code>print</code> method.</p>
<p>For plots that can't be represented as printable objects, you can
pass a function. This function must construct the plot and print
it.</p></td>
    </tr>
    <tr>
      <th>path</th>
      <td><p>The path where the test case should be stored, relative
to the <code>tests/figs/</code> folder. If <code>NULL</code> (the default), the current
testthat context is used to create a subfolder. Supply an empty
string <code>""</code> if you want the figures to be stored in the root
folder.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional arguments passed to <code><a href='https://www.rdocumentation.org/packages/testthat/topics/compare'>testthat::compare()</a></code> to
control specifics of comparison.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>Soft-deprecated. See the debugging section.</p></td>
    </tr>
    <tr>
      <th>writer</th>
      <td><p>A function that takes the plot, a target SVG file,
and an optional plot title. It should transform the plot to SVG
in a deterministic way and write it to the target file. See
<code><a href='write_svg.html'>write_svg()</a></code> (the default) for an example.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="regression-testing-versus-unit-testing"><a class="anchor" href="#regression-testing-versus-unit-testing"></a>Regression testing versus Unit testing</h2>

    
    <p>Failures to match a validated appearance are only reported when the
tests are run locally, on Travis, Appveyor, or any environment
where the <code><a href='https://www.rdocumentation.org/packages/base/topics/Sys.getenv'>Sys.getenv("CI")</a></code> or <code><a href='https://www.rdocumentation.org/packages/base/topics/Sys.getenv'>Sys.getenv("NOT_CRAN")</a></code> variables
are set. Because vdiffr is more of a monitoring than a unit testing
tool, it shouldn't cause R CMD check failures on the CRAN machines.</p>
<p>Checking the appearance of a figure is inherently fragile. It is
similar to testing for errors by matching exact error messages:
these messages are susceptible to change at any time. Similarly,
the appearance of plots depends on a lot of upstream code, such as
the way margins and spacing are computed. vdiffr uses a special
ggplot2 theme that should change very rarely, but there are just
too many upstream factors that could cause breakages. For this
reason, figure mismatches are not necessarily representative of
actual failures.</p>
<p>Visual testing is not an alternative to writing unit tests for the
internal data transformations performed during the creation of your
figure. It is more of a monitoring tool that allows you to quickly
check how the appearance of your figures changes over time, and to
manually assess whether changes reflect actual problems in your
package.</p>
<p>If you need to override the default vdiffr behaviour on CRAN (not
recommended) or Travis (for example to run the tests in a
particular builds but not others), set the <code>VDIFFR_RUN_TESTS</code>
environment variable to "true" or "false".</p>
    
    <h2 class="hasAnchor" id="debugging"><a class="anchor" href="#debugging"></a>Debugging</h2>

    
    <p>It is sometimes difficult to understand the cause of a failure.
This usually indicates that the plot is not created
deterministically. Potential culprits are:</p><ul>
<li><p>Some of the plot components depend on random variation. Try
setting a seed.</p></li>
<li><p>The plot depends on some system library. For instance sf plots
depend on libraries like GEOS and GDAL. It might not be possible
to test these plots with vdiffr (which can still be used for
manual inspection, add a <code><a href='https://www.rdocumentation.org/packages/testthat/topics/skip'>testthat::skip()</a></code> before the
<code>expect_doppelganger()</code> call in that case).</p></li>
</ul>
    <p>To help you understand the causes of a failure, vdiffr
automatically logs the SVG diff of all failures when run under R
CMD check. The log is located in <code>tests/vdiffr.Rout.fail</code> and
should be displayed on Travis.</p>
<p>You can also set the <code>VDIFFR_LOG_PATH</code> environment variable with
<code><a href='https://www.rdocumentation.org/packages/base/topics/Sys.setenv'>Sys.setenv()</a></code> to unconditionally (also interactively) log failures
in the file pointed by the variable.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> (<span class='fl'>FALSE</span>) {  <span class='co'># Not run</span>

<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/library'>library</a></span>(<span class='st'>"ggplot2"</span>)

<span class='fu'>test_that</span>(<span class='st'>"plots have known output"</span>, {
  <span class='no'>disp_hist_base</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>() <span class='fu'><a href='https://www.rdocumentation.org/packages/graphics/topics/hist'>hist</a></span>(<span class='no'>mtcars</span>$<span class='no'>disp</span>)
  <span class='fu'>expect_doppelganger</span>(<span class='st'>"disp-histogram-base"</span>, <span class='no'>disp_hist_base</span>)

  <span class='no'>disp_hist_ggplot</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span>(<span class='no'>mtcars</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span>(<span class='no'>disp</span>)) + <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_histogram.html'>geom_histogram</a></span>()
  <span class='fu'>expect_doppelganger</span>(<span class='st'>"disp-histogram-ggplot"</span>, <span class='no'>disp_hist_ggplot</span>)
})

}</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#regression-testing-versus-unit-testing">Regression testing versus Unit testing</a></li>

      <li><a href="#debugging">Debugging</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Lionel Henry, Carl Sutherland, David Hong, T Jake Luciani, Matthieu Decorde, Vaudor Lise.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

